# ComfyUI 服务设置指南

## 当前状态

经过测试，我们发现以下问题：

1. **远程ComfyUI服务器连接失败**：
   - 尝试连接到 `http://117.50.85.195:8188/` 失败
   - 错误：连接被意外关闭

2. **本地ComfyUI服务器未运行**：
   - 尝试连接到 `http://localhost:8188` 失败
   - 错误：目标计算机积极拒绝连接

## 必要步骤

在继续测试视频复刻功能之前，需要确保ComfyUI服务正常运行。请按照以下步骤操作：

### 选项1：启动本地ComfyUI服务

1. 确保ComfyUI已安装在本地计算机上
2. 启动ComfyUI服务，默认端口为8188
3. 验证服务是否正常运行：在浏览器中访问 `http://localhost:8188`

### 选项2：使用有效的远程ComfyUI服务器

1. 获取可用的远程ComfyUI服务器地址
2. 更新 `.env` 文件中的 `COMFYUI_API_ENDPOINT` 配置
3. 如果服务器需要API密钥，确保在 `.env` 文件中正确设置 `COMFYUI_API_KEY`

## 验证步骤

设置完成后，运行以下命令验证连接：

```bash
python test_comfyui_connection.py
```

该脚本将：
- 测试与ComfyUI服务器的基本连接
- 检查服务器上已加载的模型信息

## 注意事项

1. 确保ComfyUI服务器已加载必要的模型（用于视频处理、背景替换等功能）
2. 如果使用远程服务器，确保网络连接稳定且防火墙允许访问
3. 验证 `.env` 文件中的配置是否正确

## 后续步骤

一旦ComfyUI服务连接测试成功，我们可以继续测试视频复刻工具的其他功能，包括：

1. 背景替换功能
2. 产品替换功能
3. 组合替换功能

请确保在ComfyUI服务正常运行后，再运行完整的测试套件：

```bash
python run_tests.py
```